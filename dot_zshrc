# vim: ft=zsh

# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

export EDITOR=nvim
export VISUAL=nvim
export GPG_TTY=$(tty)


##### ANTIDOTE ######

zstyle ':zephyr:plugin:editor' key-bindings 'vi'

source ~/.antidote/antidote.zsh
antidote load

# fzf-tab
zstyle ':completion:*' matcher-list 'm:{[:lower:]}={[:upper:]}'
zstyle ':completion:*' list-colors "${(s.:.)LS_COLORS}"
zstyle ':completion:*' menu no


##### ZLE AND KEYBINDS #####

# Press 'V' in vi mode to edit buffer in editor
autoload edit-command-line
zle -N edit-command-line
bindkey -M vicmd V edit-command-line

# Press 'Y' in vi mode to copy buffer to OSC 52 clipboard
cmd_to_clip() { pbcopy <<< $BUFFER }
zle -N cmd_to_clip
bindkey -M vicmd Y cmd_to_clip

# Disable bracket-paste since it doesn't work well with vimode
unset zle_bracketed_paste


##### ADDITIONAL SCRIPTS #####

[ ! -f ~/.aliases.sh ] || source ~/.aliases.sh
[ ! -f ~/.cargo/env ] || . ~/.cargo/env


##### SHELL HOOKS #####

eval "$(zoxide init zsh)"
eval "$(mise activate zsh)"
source <(fzf --zsh)


##### P10K #####

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh
